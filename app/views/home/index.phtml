</head>
</body>
<?php require("resultado.php"); ?>
<header>
    <div class="header">
      <div class="center">
        <h4 class="left">NOME DO SISTEMA </h4>
        <?php echo (isset($this->alert) ? $this->alert : '' ) ?>
        <a class="rigth" href="<?php echo BASE . 'login/sair'; ?>">sair</a>
        <div class="clear"></div>
      </div>
    </div>
    <div class="sub-header">
      <div class="center">
        <h2>Eventos proximos a mim</h2>
      </div>
    </div>
  </header>
  <section class="section-home">
      <div class="center">
        <div id="map"></div>
      </div>
  </section>
 <footer>
    <div class="center">
      <a href="<?php echo BASE; ?>evento/">Criar evento</a>
      <a href="<?php echo BASE; ?>buscarEvento/">Buscar evento</a>
    </div>
  </footer>

  <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
    <script async defer
     src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAvUhehS52WPxo9Auyw_7dO7HHyLlqzmcU&callback=initMap">
     </script>
<script>
var valores = '<?php echo json_encode($eventos) ?>';
// transforma o json em objeto
var evento = JSON.parse(valores);
// percorre o objeto evento

var map;
        function initMap(){
          var map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: -6.889582, lng: -38.544935},
            zoom: 18
          });
          var infoWindow = new google.maps.InfoWindow({map: map});

          // Try HTML5 geolocation.
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };

              infoWindow.setPosition(pos);
              infoWindow.setContent('Estou aqui!');
              map.setCenter(pos);
            }, function() {
              handleLocationError(true, infoWindow, map.getCenter());
            });
          } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
          }

        //insere marcadores no mapa
        evento.forEach(function(obj, index){
          var marker = new google.maps.Marker({
              position: {lat: Number(obj.lat), lng: Number(obj.lng)},
              title:obj.tema
          });
          marker.setMap(map);
        });


        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
          infoWindow.setPosition(pos);
          infoWindow.setContent(browserHasGeolocation ?
                                'Error: The Geolocation service failed.' :
                                'Error: Your browser doesn\'t support geolocation.');
        }

        var mark = new google.maps.Marker;
        google.maps.event.addListener(mark,'click',function() {
            var infowindow = new google.maps.InfoWindow({
              content:"Hello World!"
            });
          infowindow.open(map,mark);
          });


</script>
