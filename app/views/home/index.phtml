
</head>
</body>
<?php require("resultado.php"); ?>

<header>
  <div>
    <h3>SISTEMA</h3>
  </div>
</header>

<nav class="nav left">
  <div class="div-nav">
    <ul>
      <a href="<?php echo BASE; ?>" title="Home">
        <li class="active"><i class="fa fa-home" aria-hidden="true"></i></li>
      </a>
      <a href="<?php echo BASE; ?>evento" title="Criar Evento">
        <li><i class="fa fa-plus" aria-hidden="true"></i></li>
      </a>
      <a href="<?php echo BASE; ?>" title="Buscar">
        <li><i class="fa fa-search" aria-hidden="true"></i></li>
      </a>
      <a href="<?php echo BASE . 'login/sair'; ?>" title="Sair">
        <li><i class="fa fa-sign-out" aria-hidden="true"></i></li>
      </a>
    </ul>
  </div>
</nav>
<section class="map">
  <div id="map"></div>
</section>

<footer>
  <p>Amanda e Rafaela</p>
</footer>

<script
src="https://code.jquery.com/jquery-3.3.1.min.js"
integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
crossorigin="anonymous"></script>
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAvUhehS52WPxo9Auyw_7dO7HHyLlqzmcU&callback=initMap">
</script>
<script>
var valores = '<?php echo json_encode($eventos) ?>';
// transforma o json em objeto
var evento = JSON.parse(valores);
// percorre o objeto evento

var map;
        function initMap(){
          var map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: -6.889582, lng: -38.544935},
            zoom: 18
          });
          var infoWindow = new google.maps.InfoWindow({map: map});

          // Try HTML5 geolocation.
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };

              infoWindow.setPosition(pos);
              infoWindow.setContent('Estou aqui!');
              map.setCenter(pos);
            }, function() {
              handleLocationError(true, infoWindow, map.getCenter());
            });
          } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
          }
          var marker;
          var markers = [];
        //insere marcadores no mapa
        evento.forEach(function(obj, index){
          marker = new google.maps.Marker({
              position: {lat: Number(obj.lat), lng: Number(obj.lng)},
              title:obj.tema,
              id: obj.id
          });

          marker.setMap(map);
          markers.push(marker);
        });

        /*(function (markers, evento) {
            google.maps.event.addListener(marker, "click", function (e) {
                var id = Number(marker.id);
                evento.forEach(function(obj, index){
                  if(id == Number(obj.id)){
                    var conteudo = '<h4>Titulo: ' + obj.titulo + '</h4><p>Tema: ' + obj.tema + '<br>Data: ' + obj.periodo + '</p>';
                    infoWindow.setContent(conteudo);
                    infoWindow.open(map, marker);
                  }
                  });
            });
        })(marker, evento);
        */


        google.maps.event.addListener(marker, "click", function (e) {
            var id = Number(marker.id);
            evento.forEach(function(obj, index){
              if(id == Number(obj.id)){
                var conteudo = '<h4>Titulo: ' + obj.titulo + '</h4><p>Tema: ' + obj.tema + '<br>Data: ' + obj.periodo + '</p>';
                infoWindow.setContent(conteudo);
                infoWindow.open(map, marker);
              }
              });
        });

        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
          infoWindow.setPosition(pos);
          infoWindow.setContent(browserHasGeolocation ?
                                'Error: The Geolocation service failed.' :
                                'Error: Your browser doesn\'t support geolocation.');
        }



</script>
